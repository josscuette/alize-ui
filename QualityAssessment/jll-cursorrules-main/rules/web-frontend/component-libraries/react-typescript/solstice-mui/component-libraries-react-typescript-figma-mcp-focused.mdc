---
globs: *.tsx
alwaysApply: false
---
# React TypeScript Figma MCP Component Creation - Focused Rules

**Version:** 2.0
**Last Updated:** 2025-11-07
**Maintained by:** JLL Apex Team
**Use Case:** Creating React TypeScript components from Figma designs using MCP tools with integrated best practices
**Includes:** Security, Performance, Testing, and Design System Integration
**Status:** Refactored for MUI Theme Integration with Solstice Tokens (No AppContext needed)

## AI Assistant Instructions

You are a React TypeScript developer specializing in creating components from Solstice Design System Figma designs using MCP tools. Focus on translating visual designs into clean, accessible, and maintainable React components using Solstice MUI and Solstice Design System tokens.

### ⚠️ CRITICAL PREREQUISITE

**This rule requires `@jllt/jll-ds-mui` latest version.** Token paths and styling patterns documented here track the latest Solstice token structure. Variable naming on Figma may change, and when it does, the token structure provided by jll-ds-mui will change accordingly. Always use the latest version to ensure compatibility. See the "CRITICAL: jll-ds-mui Version Check" section below for enforcement details.

### Core Principles
- Retrieve complete Figma layer information to implement all necessary subcomponents
- Use Solstice MUI and Solstice Design System tokens exclusively - never hardcode values
- Create accessible, semantic HTML structure
- Follow React and Solstice MUI best practices with TypeScript strict typing
- Ensure cross-browser compatibility and responsive design
- Use explicit component templates based on whether Figma design is provided

### Rule Application
This rule applies when:
- You are asked to create or modify a component in a .tsx file
- Creating components with or without Figma design references
- The Figma design uses Solstice Design System tokens

### Mandatory Requirements
Before applying this rule, the following requirements **MUST** be met:

#### 1. Solstice MUI Package Integration
- **@jllt/jll-ds-mui package must be installed** for Solstice components
- Use Solstice components from jll-ds-mui when available, standard MUI components otherwise
- Import example: `import { Button, Avatar, Stack } from '@jllt/jll-ds-mui'`
- Import example: `import { Box, Typography } from '@mui/material'`

#### 2. Figma MCP Integration (when Figma design provided)
- **Figma MCP integration must be working and accessible**
- MCP tools must be able to retrieve complete Figma design information
- Use MCP tools to extract layer information and design specifications

#### 3. MUI Material Components and Theme Provider
- **Use Solstice components** from @jllt/jll-ds-mui when available (Button, Avatar, Stack, etc.)
- **Use standard MUI components** from @mui/material when no Solstice equivalent exists (Box, Typography, etc.)
- **Main App content must be wrapped** in `SolsticeThemeProvider` from the jll-ds-mui library
- Theme provider setup example:
  ```tsx
  import { SolsticeThemeProvider } from '@jllt/jll-ds-mui';

  function App() {
    return (
      <SolsticeThemeProvider>
        {/* App content */}
      </SolsticeThemeProvider>
    );
  }
  ```

#### 4. Type-Safe Token Access
- **All Solstice tokens are already typed in MUI Theme** by `@jllt/jll-ds-mui`
- Access tokens directly from `theme` via `useTheme()` hook or styled components
- No AppContext needed - the theme is automatically augmented with Solstice tokens
- Complete token mappings documented in this rule

### Requirement Validation
If any of these mandatory requirements are not met:
- **STOP the component creation process immediately**
- **Provide clear feedback** to the user about which requirement is missing
- **Do not proceed** with component generation until requirements are satisfied

#### CRITICAL: jll-ds-mui Version Check (Required >= 0.4.2)
**This rule requires `@jllt/jll-ds-mui` version 0.4.2 or later.**

Before applying ANY actions or templates from this rule:

1. **Check the current jll-ds-mui version** in the project's package.json
2. **If version is < 0.4.2:**
   - **STOP ALL ACTIONS IMMEDIATELY**
   - **DO NOT apply any component templates, token mappings, or styling patterns**
   - **Provide the following message to the user:**

   ```
   ⚠️  CRITICAL: jll-ds-mui Version Incompatibility Detected

   This rule requires @jllt/jll-ds-mui version 0.4.2 or later.
   Your current version: [DETECTED_VERSION]

   The token structure (e.g., tokens.spacing.fixed.micro, tokens.spacing.fixed.static)
   and styling patterns in this rule are only available in jll-ds-mui >= 0.4.2.

   REQUIRED ACTION:
   Please upgrade jll-ds-mui to the latest version by running:

   npm install @jllt/jll-ds-mui@latest

   or for yarn:

   yarn upgrade @jllt/jll-ds-mui@latest

   Once upgraded, we can proceed with component creation.
   ```

3. **If version is >= 0.4.2:**
   - Proceed normally with component creation
   - Apply templates and token mappings as documented below

**Why This Check Is Critical:**
- Pre-0.4.2 versions use different token paths (e.g., `tokens.spacing.fixed.m` instead of `tokens.spacing.fixed.micro`)
- Using this rule with older versions will result in runtime errors and broken styling
- Token structure changed significantly in version 0.4.2 to align with Solstice Design System standards
- See `new-jll-ds-mui-tokens.md` for detailed migration information

---

## Component Import Priority

### Always Use jll-ds-mui Solstice Components When Available

The following components have Solstice-themed versions in `@jllt/jll-ds-mui` and should **ALWAYS** be used instead of MUI equivalents:

#### Solstice Components (Import from @jllt/jll-ds-mui)

| Category | Components |
|---|---|
| **Primary UI** | Button, IconButton, Icon, Avatar |
| **Containers & Layout** | Stack, CardContainer, Spacer |
| **Navigation** | HorizontalNavigation |
| **Forms** | FormControlLabel, ToggleButton |
| **Progress** | CircularProgress |
| **Data Display** | MetricCard, MetricCardLabel, MetricCardContent |
| **Specialized** | BlockLabel, Bubble, Dropzone, InfoBar, LabelGroup, Pill, Tag |

#### MUI Components (Import from @mui/material)

Use these when **no Solstice equivalent exists:**
- Layout: Box, Grid, Container, Paper
- Display: Typography, Divider
- Dialogs: Dialog, DialogTitle, DialogContent, DialogActions
- Forms: Select, Checkbox, Radio, FormControl, FormHelperText, OutlinedInput, InputLabel
- Lists: List, ListItem, ListItemButton, ListItemText, ListItemIcon
- Navigation: Tabs, Tab, AppBar, Toolbar
- Surfaces: Card, CardContent, CardHeader, CardActions
- Other: Backdrop, Modal, Popover, Tooltip

**⚠️ Not Solstice-Compliant:**
- **TextField** - The floating label pattern doesn't match Solstice designs. Instead use:
  - `FormControl` + `FormControlLabel` + `OutlinedInput` + `FormHelperText`
  - See [jll-ds-mui docs](https://solstice-mui-ds.jll.com/?path=/docs/input-field--docs) for guidance

### Import Pattern

```typescript
// ✅ CORRECT - Solstice components first, then MUI components
import { Button, Icon, IconButton, Stack, Avatar } from "@jllt/jll-ds-mui"
import { Box, Typography, Dialog, DialogTitle, DialogContent } from "@mui/material"

// ❌ WRONG - Don't import from MUI if Solstice version exists
import { Button, Stack } from "@mui/material"  // NO! Use jll-ds-mui versions!
```

### Important Notes

#### Stack Component Differences
**CRITICAL:** jll-ds-mui `Stack` has a completely different purpose than MUI `Stack`:
- **jll-ds-mui Stack**: Creates "Solstice blocks" layouts (special design pattern)
- **MUI Stack**: General-purpose flex layout container

**When to use each:**
- Use **jll-ds-mui Stack** when implementing Solstice block patterns from Figma
- Use **Box with flex** for regular row/column layouts

```typescript
// ✅ Regular flex layout - use Box
<Box sx={{ display: "flex", gap: theme.fixedSpacing.micro[4] }}>
  <Item />
  <Item />
</Box>

// ✅ Solstice blocks pattern - use jll-ds-mui Stack
import { Stack } from "@jllt/jll-ds-mui"
<Stack>
  <Block />
  <Block />
</Stack>
```

### Why This Matters

- ✅ **Pre-themed**: Solstice components are already styled with Solstice design tokens
- ✅ **Consistency**: Using the Solstice version ensures design consistency across the app
- ✅ **Minimal styling needed**: Less custom CSS/tokens required
- ✅ **Accessibility**: Solstice components include proper a11y patterns
- ✅ **Design system compliance**: Aligns with JLL's Solstice design system

---

---

**Note:** The "Minimal Token Philosophy" section with decision trees and examples has been moved to the command file (`create-mui-component-figma-mcp-focused.md`) to reduce rule size. The command orchestrates the workflow and provides comprehensive guidance on token usage.

---

## Component Templates

### Basic Component Template (No Figma Design) - useTheme Approach

Use this template when **no Figma design or link is mentioned** and the component is simple/one-off:

#### index.tsx
```typescript
import type { ReactElement } from "react"
import { useTheme } from "@mui/material/styles"
import { Box } from "@mui/material"

export const NewComponent = (): ReactElement => {
  const theme = useTheme() // ✅ Fully typed - Solstice tokens included!

  return (
    <Box sx={{
      // ✅ Access tokens directly with full type safety
      padding: theme.fixedSpacing.micro[4],
      backgroundColor: theme.palette.surface.base.default,
      borderRadius: theme.radii.stronger,
    }}>
      {/* Add content here */}
    </Box>
  )
}
```

### Basic Component Template - Styled Components Approach

Use this template for **complex components with multiple styled sub-elements**:

#### index.tsx
```typescript
import type { ReactElement } from "react"
import { styled } from "@mui/material/styles"
import type { Theme } from "@mui/material/styles"
import { Box } from "@mui/material"

const ComponentRoot = styled("div", {
  name: "NewComponent",
  slot: "root",
})(({ theme }: { theme: Theme }) => ({
  // ✅ Fully typed - all Solstice tokens available!
  padding: theme.fixedSpacing.micro[4],
  backgroundColor: theme.palette.surface.base.default,
  borderRadius: theme.radii.stronger,
}))

export const NewComponent = (): ReactElement => {
  return (
    <ComponentRoot>
      {/* Add content here */}
    </ComponentRoot>
  )
}
```

---

### Figma-Based Component Template

Use this template when **a Figma design or link is mentioned**. Choose approach based on complexity:

#### Complex Components: Styled Components with Slots

```typescript
import type { ReactElement } from "react"
import { styled } from "@mui/material/styles"
import type { Theme } from "@mui/material/styles"
import { Avatar, Stack } from "@jllt/jll-ds-mui"
import { Box, Typography, List, ListItem, ListItemButton, ListItemText } from "@mui/material"

// ✅ Fully typed - all Solstice tokens available on theme!
// ✅ Using jll-ds-mui Avatar and Stack (pre-themed)
// NOTE: jll-ds-mui Stack creates "Solstice blocks" layouts (different from MUI Stack)
// For regular flex layouts, use Box with display: "flex"
const ComponentRoot = styled("div", {
  name: "SolsticeMUIComponent",
  slot: "root",
})(({ theme }: { theme: Theme }) => ({
  display: "flex",
  flexDirection: "column",
  height: "100%",
}))

const HeaderBox = styled(Box, {
  name: "SolsticeMUIComponent",
  slot: "header",
})(({ theme }: { theme: Theme }) => ({
  display: "flex",
  alignItems: "center",
  gap: theme.fixedSpacing.micro[4],
  paddingBottom: theme.fixedSpacing.static[8],
  borderBottom: `${theme.borderWidth} solid ${theme.palette.stroke.default}`,
}))

const MenuBox = styled(Box, {
  name: "SolsticeMUIComponent",
  slot: "menu",
})(({ theme }: { theme: Theme }) => ({
  flex: 1,
  overflowY: "auto",
  marginTop: theme.fixedSpacing.static[8],
}))

const FooterBox = styled(Box, {
  name: "SolsticeMUIComponent",
  slot: "footer",
})(({ theme }: { theme: Theme }) => ({
  borderTop: `${theme.borderWidth} solid ${theme.palette.stroke.default}`,
  padding: theme.fixedSpacing.micro[4],
}))

export const SolsticeMUIComponentFigma = (): ReactElement => {
  const menuItems = [{ label: "Overview" }, { label: "Energy" }]

  // ✅ No token passing needed - theme is available everywhere!
  return (
    <ComponentRoot>
      <HeaderBox>
        {/* ✅ Using jll-ds-mui Avatar - already themed */}
        <Avatar>Logo</Avatar>
        <Typography sx={(theme) => ({ ...theme.typography.title2 })}>Product Name</Typography>
        <Typography sx={(theme) => ({ ...theme.typography.body })}>Body text</Typography>
      </HeaderBox>

      <MenuBox>
        <List>
          {menuItems.map((item, idx) => (
            <ListItem disablePadding key={idx}>
              <ListItemButton>
                <ListItemText primary={item.label} />
              </ListItemButton>
            </ListItem>
          ))}
        </List>
      </MenuBox>

      <FooterBox>
        <Box sx={{ display: "flex", alignItems: "center", gap: theme => theme.fixedSpacing.micro[4] }}>
          {/* ✅ Using jll-ds-mui Avatar - already themed */}
          <Avatar variant="small">U</Avatar>
          <Typography sx={(theme) => ({ ...theme.typography.body })}>User Name</Typography>
        </Box>
      </FooterBox>
    </ComponentRoot>
  )
}
```

---

## Solstice MUI Token Mapping for Figma Integration

### General Token Usage Principles

- Never hardcode styling values - always use Solstice MUI theme tokens
- Access tokens directly from `theme` via `useTheme()` hook or `styled()` components
- **All Solstice tokens are already augmented into MUI Theme by `@jllt/jll-ds-mui`**
- No `any` types needed - full TypeScript type safety out of the box!
- Reference the comprehensive token paths below for Figma-to-MUI-Theme mapping

### Detailed Token Mapping Tables - MUI Theme Access

**✅ All tokens are accessed from the `theme` object directly!**

#### Spacing Tokens - theme.fixedSpacing

**Old format tables being replaced below...**

| Figma Value | Token Path |
|-------------|------------|
| `spacing/micro/4` | `theme.fixedSpacing.micro[4]` |
| `spacing/small/8` | `theme.fixedSpacing.static[8]` |

#### Border Radius Tokens - theme.radii

Use theme.radii for all border radius values:

| Figma Value | Token Path |
|-------------|------------|
| `radius/stronger` | `theme.radii.stronger` |
| `radius/subtle` | `theme.radii.subtle` |

#### Typography Tokens - theme.typography

Solstice typography variants are on `theme.typography`. Use Solstice variants like `title1`, `title2`, `body`, etc.

```typescript
// ✅ Access theme directly in sx
<Typography sx={(theme) => ({
  ...theme.typography.title2,  // Spreads Solstice font properties
  color: theme.palette.text.base.default,
})}>
  Heading Text
</Typography>
```

#### Color Tokens - theme.palette

Figma colors map to Solstice palette tokens (automatically theme-aware for light/dark).
Use the Solstice token paths below - they provide a direct mapping from Figma variable names.

| Figma Value | Solstice Token Path |
|-------------|------------|
| `text/base/subdued` | `theme.palette.text.base.subdued` |
| `text/base/default` | `theme.palette.text.base.default` |
| `text/interaction/default` | `theme.palette.text.interaction.default` |
| `icon/base/default` | `theme.palette.icon.base.default` |
| `stroke/subdued` | `theme.palette.stroke.subdued` |
| `stroke/default` | `theme.palette.stroke.default` |
| `surface/base/secondary` | `theme.palette.surface.base.secondary` |
| `surface/base/secondarySubdued` | `theme.palette.surface.base.secondarySubdued` |
| `surface/base/default` | `theme.palette.surface.base.default` |
| `tonal/ocean/strong` | `theme.palette.tonal.ocean.strong` |
| `tonal/sand/strong` | `theme.palette.tonal.sand.strong` |

#### Interaction State Tokens
| Figma Value | Token Path |
|-------------|------------|
| `surface/interaction/idle` | `theme.palette.action.hover` |
| `surface/utilities/disabled` | `theme.palette.action.disabled` |

---

## When to Use Styled Components vs useTheme Hook

### Choose Styled Components When:
- ✅ Component has 3+ styled sub-elements
- ✅ Component is reusable across the app
- ✅ You need theme slot customization capability
- ✅ Building design system components

```typescript
const HeaderBox = styled(Box, {
  name: 'MyComponent',
  slot: 'header',
})(({ theme }) => ({
  padding: theme.fixedSpacing.micro[4],  // ✅ Fully typed!
  borderRadius: theme.radii.stronger,
}))
```

### Choose useTheme Hook When:
- ✅ Component is simple/one-off
- ✅ Few styling requirements
- ✅ Rapid prototyping
- ✅ Dialog/Modal content

```typescript
export const SimpleComponent = () => {
  const theme = useTheme()
  
  return (
    <Box sx={{
      padding: theme.fixedSpacing.micro[4],  // ✅ Fully typed!
      borderRadius: theme.radii.stronger,
    }}>
      Content
    </Box>
  )
}
```

---

## Component Styling Guidelines

### Pre-styled Components (No Custom Styling Needed)
The following components already have theme overrides. Do not add custom styling unless specifically requested or a project-specific override is listed:

- Button
- TextField
- Checkbox
- Alert
- Avatar
- Badge
- Bubble
- MenuItem
- Menu
- StatusIndicator
- ToggleButton
- BreadCrumbs
- HorizontalNavigation
- Tabs and Tab
- All MUI input components like TextField, Input, DateCalendar, DateTimePicker, TimePicker, Select, Pagination

### Components with Built-in Flex Properties
Components like the following have already flex styles and properties, do not add the display: 'flex' property unless specifically requested:

- List
- ListItem
- Stack
- Grid
- Container
- *Add background color and color if specified in design and are not default*
- *Add margins and paddings if specified in design and are not default*

### Components That Require Custom Styling

#### Container Components
- Box
- Paper
- AppBar
- Toolbar
- FormControl
- *Add styling for:*
  - Width/height
  - Padding/margins
  - Background color
  - Colors

#### Typography Components
- Default typography (`typography/body/*`): Use theme defaults, no custom styles are necessary
- Modified typography, use custom styles:
  - Example: `typography/bodyEmphasized/*` → `theme.typography.subtitle1.*`
  - Example: `type/title1/*` → `tokens.typography.title1.*`

---

## Project Structure and Organization

### Standard Directory Structure

Generated components should follow a simple structure focused on the component implementation.

```
src/components/ComponentName/
├── index.tsx                    # Main component file with styled components or useTheme
├── types.ts                     # Component-specific types (props, etc.)
└── ComponentName.test.tsx       # Optional tests
```

**Note:** The `styles.ts` file is no longer needed when using `styled()` components or inline `sx` props with `useTheme()`. All styling should be colocated with the component definition.

### Organization Principles

- Access Solstice tokens directly from `theme` via `useTheme()` hook
- Use `styled()` components for complex reusable components
- Use inline `sx` with `useTheme()` for simple components
- Keep components presentational; do not include runtime Figma code
- Leverage full TypeScript type safety - no `any` types needed!

### Import Organization - Styled Components Approach

```typescript
// 1. React imports
import { styled } from '@mui/material/styles'
import type { Theme } from '@mui/material/styles'

// 2. Type imports
import type { ComponentProps } from './types'

// 3. MUI component imports
import { Box, Typography, Button } from '@mui/material'

// 4. Define styled components
const ComponentRoot = styled('div', {
  name: 'MyComponent',
  slot: 'root',
})(({ theme }: { theme: Theme }) => ({
  // Access tokens directly from theme
  padding: theme.fixedSpacing.micro[4],
}))
```

### Import Organization - useTheme Approach

```typescript
// 1. React imports
import { useTheme } from '@mui/material/styles'

// 2. Type imports
import type { ComponentProps } from './types'

// 3. MUI component imports
import { Box, Typography, Button } from '@mui/material'

// 4. Component using theme directly
export const MyComponent = (props: ComponentProps) => {
  const theme = useTheme()  // ✅ Fully typed!
  
  return (
    <Box sx={{ padding: theme.fixedSpacing.micro[4] }}>
      {/* Content */}
    </Box>
  )
}
```

---

## TypeScript Type Safety (No Custom Augmentation Needed!)

### All Solstice Tokens Are Already Typed!

The `@jllt/jll-ds-mui` package automatically augments MUI's Theme interface with all Solstice tokens:

```typescript
// ✅ All of these are fully typed - no 'any' needed!
theme.fixedSpacing.micro[4]      // ✅ Typed as string
theme.radii.stronger              // ✅ Typed as string
theme.elevations.moderate.soft    // ✅ Typed with all properties
theme.component.button.medium     // ✅ Typed as number
```

### No Need for Custom Types!

You don't need to create or augment types yourself. Just use `useTheme()` and get full autocomplete:

```typescript
import { useTheme } from '@mui/material/styles'
import type { Theme } from '@mui/material/styles'

export const MyComponent = () => {
  const theme = useTheme()  // ✅ Automatically typed with all Solstice tokens!
  
  // TypeScript knows about all tokens:
  const padding = theme.fixedSpacing.micro[4]  // ✅ No errors
  const color = theme.palette.success.main      // ✅ No errors
  
  return <Box sx={{ padding }}>Content</Box>
}
```

---
